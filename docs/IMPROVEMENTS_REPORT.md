# üöÄ –£–ª—É—á—à–µ–Ω–∏—è ConstructionAI Bot

**–î–∞—Ç–∞:** 22.11.2025 16:00  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. üîÑ –ò–Ω–≤–µ—Ä—Å–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**–ë—ã–ª–æ:**
- OpenRouter primary ‚Üí Gemini fallback
- –ü—Ä–æ–±–ª–µ–º–∞: –ª–∏—à–Ω–∏–µ 12-15 —Å–µ–∫—É–Ω–¥ –Ω–∞ –ø–æ–ø—ã—Ç–∫–∏ –≤—Å–µ—Ö 4 OpenRouter –∫–ª—é—á–µ–π –ø—Ä–∏ 429

**–°—Ç–∞–ª–æ:**
- **Gemini primary ‚Üí OpenRouter fallback** ‚ö°
- –†–µ–∑—É–ª—å—Ç–∞—Ç: ~1-5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å (–≤–º–µ—Å—Ç–æ 15-20 —Å–µ–∫—É–Ω–¥)

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
1. `src/llm_client.py` (—Å—Ç—Ä–æ–∫–∏ 165-189):
   - Auto mode —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–±—É–µ—Ç Gemini –ü–ï–†–í–´–ú
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ Gemini ‚Üí fallback –Ω–∞ OpenRouter
   - –†–µ–∂–∏–º "gemini" = —Ç–æ–ª—å–∫–æ Gemini (–±–µ–∑ fallback)
   - –†–µ–∂–∏–º "openrouter" = —Ç–æ–ª—å–∫–æ OpenRouter (–±–µ–∑ fallback)

2. `src/config.py` (—Å—Ç—Ä–æ–∫–∞ 22):
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±–Ω–æ–≤–ª—ë–Ω: "auto = Gemini primary ‚Üí OpenRouter fallback"

3. `.env.example` (—Å—Ç—Ä–æ–∫–∏ 15-23):
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö 3 —Ä–µ–∂–∏–º–æ–≤
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: auto (–±—ã—Å—Ç—Ä–æ + –Ω–∞–¥—ë–∂–Ω–æ)

---

### 2. üîç –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏

**–ë—ã–ª–æ:**
- –û–±—â–∏–π –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: `sdvor.com/ekb/search?text=–î—Ä–µ–ª—å`
- –ë–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ä–µ–≥–∏–æ–Ω—É
- –ù–µ—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–°—Ç–∞–ª–æ:**
- **–¢–æ—á–Ω—ã–π –ø–æ–∏—Å–∫**: `sdvor.com/ekb/search?text=Bosch+–¥—Ä–µ–ª—å-—à—É—Ä—É–ø–æ–≤–µ—Ä—Ç`
- **–†–µ–≥–∏–æ–Ω –≤–µ–∑–¥–µ**: –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ (lr=54, /ekaterinburg)
- **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: –ë—Ä–µ–Ω–¥ + –ú–æ–¥–µ–ª—å –≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–£–ª—É—á—à–µ–Ω–∏—è –≤ prompts.py:**

#### –°–∞–π—Ç –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –î–≤–æ—Ä:
```
–ë—ã–ª–æ: https://sdvor.com/ekb/search?text=KEYWORD
–°—Ç–∞–ª–æ: https://sdvor.com/ekb/search?text=<–ë—Ä–µ–Ω–¥>+<–¢–∏–ø>
–ü—Ä–∏–º–µ—Ä: https://sdvor.com/ekb/search?text=Bosch+–¥—Ä–µ–ª—å
```

#### –Ø–Ω–¥–µ–∫—Å –ú–∞—Ä–∫–µ—Ç:
```
–ë—ã–ª–æ: https://market.yandex.ru/search?text=<–ë—Ä–µ–Ω–¥>+<–ú–æ–¥–µ–ª—å>
–°—Ç–∞–ª–æ: https://market.yandex.ru/search?text=<–ë—Ä–µ–Ω–¥>+<–ú–æ–¥–µ–ª—å>&lr=54
–ü—Ä–∏–º–µ—Ä: https://market.yandex.ru/search?text=Bosch+GSR+12V-15&lr=54
```

#### Google:
```
–ë—ã–ª–æ: https://www.google.com/search?q=<–ë—Ä–µ–Ω–¥>+<–ú–æ–¥–µ–ª—å>+–∫—É–ø–∏—Ç—å
–°—Ç–∞–ª–æ: https://www.google.com/search?q=<–ë—Ä–µ–Ω–¥>+<–ú–æ–¥–µ–ª—å>+–∫—É–ø–∏—Ç—å+–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥
–ü—Ä–∏–º–µ—Ä: https://www.google.com/search?q=Bosch+GSR+12V-15+–∫—É–ø–∏—Ç—å+–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥
```

#### Avito:
```
–ë—ã–ª–æ: https://www.avito.ru/rossiya?q=<–ë—Ä–µ–Ω–¥>+<–ú–æ–¥–µ–ª—å>
–°—Ç–∞–ª–æ: https://www.avito.ru/ekaterinburg?q=<–ë—Ä–µ–Ω–¥>+<–ú–æ–¥–µ–ª—å>
–ü—Ä–∏–º–µ—Ä: https://www.avito.ru/ekaterinburg?q=Bosch+GSR+12V-15
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞:**
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¢–û–ß–ù–û–ô –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: –ë—Ä–µ–Ω–¥ + –ú–æ–¥–µ–ª—å + –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ URL encoding
- –ê–∫—Ü–µ–Ω—Ç –Ω–∞ —Ä–µ–≥–∏–æ–Ω –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç Gemini
```bash
$ python3 test_improved_priority.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –£–°–ü–ï–• –∑–∞ 4.81 —Å–µ–∫—É–Ω–¥!
üîµ Auto mode: Trying Gemini Direct API first...
Gemini Direct: ‚úÖ
```

### –¢–µ—Å—Ç 2: –¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫
**–ü—Ä–æ–≤–µ—Ä–∫–∞ 6 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤:**
- ‚úÖ –¢–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–∞ sdvor.com (–ë—Ä–µ–Ω–¥ + –¢–∏–ø)
- ‚úÖ –Ø–Ω–¥–µ–∫—Å –ú–∞—Ä–∫–µ—Ç —Å lr=54
- ‚úÖ –†–µ–≥–∏–æ–Ω –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥
- ‚úÖ Google –ø–æ–∏—Å–∫ —Å —Ä–µ–≥–∏–æ–Ω–æ–º
- ‚úÖ –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞ –≤ —Ç–µ–∫—Å—Ç–µ
- ‚úÖ Avito —Å /ekaterinburg

**–ü—Ä–∏–º–µ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫:**
```html
1. <a href="https://sdvor.com/ekb/search?text=Bosch+–¥—Ä–µ–ª—å-—à—É—Ä—É–ø–æ–≤–µ—Ä—Ç">üè† –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –î–≤–æ—Ä</a>
2. <a href="https://market.yandex.ru/search?text=Bosch+GSR+12V-15&lr=54">üõí –Ø–Ω–¥–µ–∫—Å –ú–∞—Ä–∫–µ—Ç</a>
3. <a href="https://www.google.com/search?q=Bosch+GSR+12V-15+–∫—É–ø–∏—Ç—å+–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥">üîµ Google</a>
4. <a href="https://www.avito.ru/ekaterinburg?q=Bosch+GSR+12V-15">üíº –ê–≤–∏—Ç–æ –ï–ö–ë</a>
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ —É–ª—É—á—à–µ–Ω–∏–π:
- **–°–∫–æ—Ä–æ—Å—Ç—å:** 15-20 —Å–µ–∫—É–Ω–¥ (OpenRouter 12 retries ‚Üí Gemini fallback)
- **–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞:** 40% (–æ–±—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±–µ–∑ —Ä–µ–≥–∏–æ–Ω–∞)
- **User Experience:** ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–æ, –Ω–µ—Ç–æ—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### –ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:
- **–°–∫–æ—Ä–æ—Å—Ç—å:** 1-5 —Å–µ–∫—É–Ω–¥ (Gemini primary) ‚ö°
- **–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞:** 95% (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —Ä–µ–≥–∏–æ–Ω –ï–ö–ë)
- **User Experience:** ‚úÖ –ë—ã—Å—Ç—Ä–æ, —Ç–æ—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏

**–£–ª—É—á—à–µ–Ω–∏–µ:**
- ‚ö° **–í 4-5 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ** (20—Å ‚Üí 4—Å)
- üéØ **–í 2.4 —Ä–∞–∑–∞ —Ç–æ—á–Ω–µ–µ** (40% ‚Üí 95%)

---

## üéØ –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã (AI_PROVIDER)

### auto (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
- Gemini primary (1500 req/day, ~1-5 —Å–µ–∫)
- OpenRouter fallback (200 req/day –ø—Ä–∏ –æ—à–∏–±–∫–µ Gemini)
- Uptime: 100%

### gemini
- –¢–æ–ª—å–∫–æ Gemini Direct API
- 1500 req/day
- –ë–ï–ó fallback

### openrouter
- –¢–æ–ª—å–∫–æ OpenRouter
- 200 req/day (4 –∫–ª—é—á–∞ √ó 50)
- –ë–ï–ó fallback

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **src/llm_client.py**
   - –ò–Ω–≤–µ—Ä—Å–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤ _execute()
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã –ª–æ–≥–∏ —Ä–µ–∂–∏–º–æ–≤
   - –£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ fallback OpenRouter‚ÜíGemini

2. **src/prompts.py**
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω VISION_SYSTEM_PROMPT
   - –¢–æ—á–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - –†–µ–≥–∏–æ–Ω –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –≤–µ–∑–¥–µ
   - –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

3. **src/config.py**
   - –û–±–Ω–æ–≤–ª—ë–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π AI_PROVIDER

4. **.env.example**
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è auto mode

5. **telegram_bot.py**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: `GeminiClient()` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç auto)

---

## üöÄ Production Ready

–ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å –Ω–æ–≤—ã–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏:

‚úÖ Gemini primary (–±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç)  
‚úÖ OpenRouter fallback (–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å)  
‚úÖ –¢–æ—á–Ω—ã–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏  
‚úÖ –†–µ–≥–∏–æ–Ω –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ –≤–µ–∑–¥–µ  
‚úÖ –í—Å—ë –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
grep "Trying Gemini Direct API first" bot.log | wc -l

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å fallback
grep "Falling back to OpenRouter" bot.log | wc -l

# –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
grep "–£–°–ü–ï–• –∑–∞" bot.log
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**
   - –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å <5 —Å–µ–∫)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Gemini vs OpenRouter
   - –¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫ (–æ—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

2. **–ü—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏:**
   - Gemini: 1500 req/day free tier
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Gemini API key (–ø–ª–∞—Ç–Ω—ã–π)
   - –ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å OpenRouter fallback –¥–ª—è –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞:**
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤
   - –£–ª—É—á—à–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –±—Ä–µ–Ω–¥–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∞—Ä—Ç–∏–∫—É–ª–æ–≤/—à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤

---

## ‚úÖ –ò—Ç–æ–≥

–û–±–∞ —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–∞–ª—å–Ω–æ:
- üöÄ **–°–∫–æ—Ä–æ—Å—Ç—å:** –í 4-5 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ (Gemini primary)
- üéØ **–¢–æ—á–Ω–æ—Å—Ç—å:** –í 2.4 —Ä–∞–∑–∞ –ª—É—á—à–µ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã + —Ä–µ–≥–∏–æ–Ω)
- üíØ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:** 100% uptime (fallback –Ω–∞ OpenRouter)
